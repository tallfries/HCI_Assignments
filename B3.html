<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B3: Image Generator</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
    }
    #foodImage {
        max-width: 80%;
        max-height: 80vh;
        margin: 0 auto;
        display: block;
        position:fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
</style>
</head>
<body>
        <h2 id="instruction">Press space bar to start!</h2>
        <div id="stimulusCount"></div>
        <br>
        <div id="meanG"></div>
        <div id="sdG"></div>
        <div id="errorG"></div>
        <br>
        <div id="meanC"></div>
        <div id="sdC"></div> 
        <div id="errorC"></div>
        <br>
        <div id="meanM"></div>
        <div id="sdM"></div>
        <div id="errorM"></div>
        <img id="foodImage" src="" alt="">
        
    <script>
        const chineseFood = [
            "baozi.png", "di_san_xian.png", "fruehlingsrolle.png", "jiaozi.png", "kun_pao.png",
            "peking_ente.png", "peking_suppe.png", "tofu.png", "wonton.png", "youtiao.png",
        ];

        const germanFood = [
            "brezeln.png", "currywurst.png", "kartoffelsalat.png", "maultaschen.png", "rotkohl.png",
            "sauerkraut.png", "schnitzel.png", "spaetzle.png", "torte.png", "wurst_bier.png"
        ];

        const mexicanFood = [
            "avocado.png", "churros.png", "enchiladas.png", "mais.png", "paella.png",
            "pan_dulce.png", "tacos.png", "tamales.png", "tortilla.png", "wrap.png"
        ];

        const allFood = [chineseFood, germanFood, mexicanFood];
        let country;

        function generateFood(){
            // Case: allFood still has chineseFood,germanFood and mexicanFood
            if(allFood.length === 3){
                // index can be 0, 1 or 2. Depending on its value we display chinese, german or mexican food
                index = Math.floor(Math.random() * 3);
                let image = document.getElementById('foodImage');
                // display chinese food
                if (index === 0){
                    const indexChinese = Math.floor(Math.random() * chineseFood.length);
                    image.src = "foodImages/" + chineseFood[indexChinese];
                    stimulusTime = Date.now();
                    chineseFood.splice(indexChinese,1);
                    if(chineseFood.length === 0){
                        allFood.splice(0,1);
                    }
                    country = "CHI";
                // display german food
                }else if (index ===1){
                    const indexGerman = Math.floor(Math.random() * germanFood.length);
                    image.src = "foodImages/" + germanFood[indexGerman];
                    stimulusTime = Date.now();
                    germanFood.splice(indexGerman,1);
                    if(germanFood.length === 0){
                        allFood.splice(1,1);
                    }
                    country = "GER";
                // display mexican food
                }else if (index ===2){
                    const indexMexican = Math.floor(Math.random() * mexicanFood.length);
                    image.src = "foodImages/" + mexicanFood[indexMexican];
                    stimulusTime = Date.now();
                    mexicanFood.splice(indexMexican,1);
                    if(mexicanFood.length === 0){
                        allFood.splice(2,1);
                    }
                    country = "MEX";
                }
                return country;
            // Case: allFood has only 2 indexes
            }else if(allFood.length === 2){
                index = Math.floor(Math.random() * 2);
                let image = document.getElementById('foodImage');
                // Case 1: chinese and german are in allFood
                if(allFood[0] === chineseFood && allFood[1] === germanFood){
                    // display chinese food
                    if(index === 0){
                        const indexChinese = Math.floor(Math.random() * chineseFood.length);
                        image.src = "foodImages/" + chineseFood[indexChinese];
                        stimulusTime = Date.now();
                        chineseFood.splice(indexChinese,1);
                        if(chineseFood.length === 0){
                            allFood.splice(0,1);
                        }
                        country = "CHI";
                    // display german food
                    }else if(index === 1){
                        const indexGerman = Math.floor(Math.random() * germanFood.length);
                        image.src = "foodImages/" + germanFood[indexGerman];
                        stimulusTime = Date.now();
                        germanFood.splice(indexGerman,1);
                        if(germanFood.length === 0){
                            allFood.splice(1,1);
                        }
                        country = "GER";
                    }
                }

                // Case 2: chinese and mexican are in allFood
                else if(allFood[0] === chineseFood && allFood[1] === mexicanFood){
                    // display chinese food
                    if(index === 0){
                        const indexChinese = Math.floor(Math.random() * chineseFood.length);
                        image.src = "foodImages/" + chineseFood[indexChinese];
                        stimulusTime = Date.now();
                        chineseFood.splice(indexChinese,1);
                        if(chineseFood.length === 0){
                            allFood.splice(0,1);
                        }
                        country = "CHI";
                    // display mexican food
                    }else if(index === 1){
                        const indexMexican = Math.floor(Math.random() * mexicanFood.length);
                        image.src = "foodImages/" + mexicanFood[indexMexican];
                        stimulusTime = Date.now();
                        mexicanFood.splice(indexMexican,1);
                        if(mexicanFood.length === 0){
                            allFood.splice(1,1);
                        }
                        country = "MEX";
                    }
                }
                
                // Case 3: german and mexican are in allFood
                else if(allFood[0] === germanFood && allFood[1] === mexicanFood){
                    // display german food
                    if(index === 0){
                        const indexGerman = Math.floor(Math.random() * germanFood.length);
                        image.src = "foodImages/" + germanFood[indexGerman];
                        stimulusTime = Date.now();
                        germanFood.splice(indexGerman,1);
                        if(germanFood.length === 0){
                            allFood.splice(0,1);
                        }
                        country = "GER";
                    // display mexican food
                    }else if(index === 1){
                        const indexMexican = Math.floor(Math.random() * mexicanFood.length);
                        image.src = "foodImages/" + mexicanFood[indexMexican];
                        stimulusTime = Date.now();
                        mexicanFood.splice(indexMexican,1);
                        if(mexicanFood.length === 0){
                            allFood.splice(1,1);
                        }
                        country = "MEX";
                    }
                }
                return country;
            // Case: allFood has only one index
            }else if(allFood.length === 1){
                index = 0;
                let image = document.getElementById('foodImage');
                // display chinese food
                if(allFood[index] === chineseFood){
                    const indexChinese = Math.floor(Math.random() * chineseFood.length);
                    image.src = "foodImages/" + chineseFood[indexChinese];
                    stimulusTime = Date.now();
                    chineseFood.splice(indexChinese,1);
                    if(chineseFood.length === 0){
                        allFood.splice(0,1);
                    }
                    country = "CHI";
                // display german food
                }else if(allFood[index] === germanFood){
                    const indexGerman = Math.floor(Math.random() * germanFood.length);
                    image.src = "foodImages/" + germanFood[indexGerman];
                    stimulusTime = Date.now();
                    germanFood.splice(indexGerman,1);
                    if(germanFood.length === 0){
                        allFood.splice(0,1);
                    }
                    country = "GER";
                // display mexican food
                }else if(allFood[index] === mexicanFood){
                    const indexMexican = Math.floor(Math.random() * mexicanFood.length);
                    image.src = "foodImages/" + mexicanFood[indexMexican];
                    stimulusTime = Date.now();
                    mexicanFood.splice(indexMexican,1);
                    if(mexicanFood.length === 0){
                        allFood.splice(0,1);
                    }
                    country = "MEX";
                }
                return country;
            }
        }
        

        // Declaration of Variables for exercise
            let experimentActive = false;
            let stimulusIsVisible = false;
            //Start period of the reaction time being recorded
            let stimulusTime;
            //Placeholder variable to track pausing between stimuli
            let stimulusTimeout;

            //Reaction times for each country
            let timeGER = [];
            let timeCHI = [];
            let timeMEX = [];

            //Country specific Error Counts
            let errorCountGER = 0;
            let errorCountCHI = 0;
            let errorCountMEX = 0;
                    
            let foodIx = 0;
            let count = 0;

            // DOM Elements
            let stimulusCountElement = document.getElementById('stimulusCount');
            let imageElement = document.getElementById('foodImage');
            let meanGERElement = document.getElementById('meanG');
            let meanCHIElement = document.getElementById('meanC');
            let meanMEXElement = document.getElementById('meanM');
            let stdGERElement = document.getElementById('sdG');
            let stdCHIElement = document.getElementById('sdC');
            let stdMEXElement = document.getElementById('sdM');
            let errorGERElement = document.getElementById('errorG');
            let errorCHIElement = document.getElementById('errorC');
            let errorMEXElement = document.getElementById('errorM');
            let instructionElement = document.getElementById('instruction');
            
        // Method to calculate mean
        function getMean(data){
            if(data.length === 0) return 0;
            let sum = 0;
            for (let value of data){
                sum+= value;
            }
            return (sum/data.length);
        }
        
        // Method to calculate standard deviation
        function getStandardDeviation(data){
            if(data.length === 0) return 0;
            let mean = getMean(data);
            let squareSum = 0;
            for (let value of data){
                squareSum += Math.pow((value-mean),2);
            }
            return Math.sqrt(squareSum / data.length);
        }

        // Displays the results of the experiment, grouped by each country: Germany, China, Mexico
        function showResults(){
            meanGERElement.innerHTML = "<strong>Germany: </strong>Mean Reaction " + Math.round(getMean(timeGER)) + "ms";
            stdGERElement.textContent = "Standard Deviation " + Math.round((getStandardDeviation(timeGER))) + "ms";
            errorGERElement.textContent = "Error Rate " + (errorCountGER / 10)*100 + "%";
            
            meanCHIElement.innerHTML = "<strong>China: </strong>Mean Reaction " + Math.round(getMean(timeCHI)) + "ms";
            stdCHIElement.textContent = "Standard Deviation " + Math.round((getStandardDeviation(timeCHI))) + "ms";
            errorCHIElement.textContent = "Error Rate " + (errorCountCHI / 10)*100 + "%";
            
            meanMEXElement.innerHTML = "<strong>Mexico: </strong>Mean Reaction " + Math.round(getMean(timeMEX)) + "ms";
            stdMEXElement.textContent = "Standard Deviation " + Math.round((getStandardDeviation(timeMEX))) + "ms";
            errorMEXElement.textContent = "Error Rate " + (errorCountMEX / 10)*100 + "%" ;

            imageElement.style.display = "none";
        }
        
        // Clears all results
        function clearResults(){
            const elements = [meanGERElement,meanCHIElement,meanMEXElement,errorGERElement,errorCHIElement,errorMEXElement,stdGERElement,stdCHIElement,stdMEXElement];
            elements.forEach(element => {
                element.textContent = "";
            });
        }
        
        // Starts the experiment
        function startExperiment(){
            instructionElement.textContent = "Press 'd' for Germany, 'f' for China and 'g' for Mexico.";
            timeGER = [];
            timeCHI = [];
            timeMEX = [];
            errorCountGER, errorCountCHI, errorCountMEX = 0;

            experimentActive = true;
            startTestTrial();
        }

        // Stops the experiment
        function stopExperiment(){
            clearTimeout(stimulusTimeout);
            stimulusIsVisible = false;
            experimentActive = false;
            count = foodIx;
            foodIx = 0;
        }

        // Starts a test trial
        function startTestTrial(){
            stimulusIsVisible = false;
            if (count < 30){
                updateStimulusCount();
                stimulusTimeout = setTimeout(generateFood, (Math.random() * 4 + 2) * 1000);
            }
        }

        // displays the current stimulus count
        function updateStimulusCount(){
            stimulusCountElement.textContent = "Stimulus Count: " + foodIx + "/30";
        }

        //Records Reaction Time for Germany
        function recordReactionTimeGER(){
            let timeEnd = Date.now() - stimulusTime;
            //let country= images[count].country;
            if(country === "GER"){
                timeGER.push(timeEnd);
                count++;
            } else {
                errorCountGER++;
            }
        }
        
        //Records Reaction Time for China
        function recordReactionTimeCHI(){
            let timeEnd = Date.now() - stimulusTime;
            if(country === "CHI"){
                
                timeCHI.push(timeEnd);
                count++;
            } else {
                errorCountCHI++;
            }
        }

        //Records Reaction Time for Mexico
        function recordReactionTimeMEX(){
            let timeEnd = Date.now() - stimulusTime;
            if(country === "MEX"){
                timeMEX.push(timeEnd);
                count++;
            } else {
                errorCountMEX++;
            }
        }

        //Handles key inputs required for the experiment
        window.addEventListener('keydown', (event) => {
            
        if(foodIx<30) {
            //Pressing space bar to start the experiment
            if (event.key === ' ' && !experimentActive) {
                    clearResults();
                    startExperiment();
                    foodIx++;
                    return;
            } else if (event.key === 'd') { //Handles pressing the button d
                recordReactionTimeGER();
                startTestTrial();
                foodIx++;
                if(allFood.length === 0){
                    stopExperiment();
                }
            }  else if (event.key === 'f') { //Handles pressing the button f
                recordReactionTimeCHI();
                startTestTrial();
                foodIx++;
                if(allFood.length === 0){
                    stopExperiment();
                }
            } else if (event.key === 'g') { //Handles pressing the button g
                recordReactionTimeMEX();
                console.log(recordReactionTimeMEX);
                startTestTrial();
                foodIx++;
                if(allFood.length === 0){
                    stopExperiment();
                }
            } else if (event.key==='a') { //Handles pressing the button a 
                if(experimentActive){
                    stopExperiment();   
                }
            }
        }else{
            updateStimulusCount();
            showResults();
        }
        });         
    </script>
</body>
</html>